<!DOCTYPE html>
<html>
<head>
    <title>UserProfile</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="/CookIt/Cook%20It/css/Styles.css" >
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.5/css/bootstrap.min.css" integrity="sha384-AysaV+vQoT3kOAXZkl02PThvDr8HYKPZhNT5h/CXfBThSRXQ6jW5DO2ekP5ViFdi" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script type = "text/javascript" src="jqueryFiles/scripts.js"></script>
</head>
    
    <nav class="navbar navbar-dark bg-inverse" id = "Menubar">
        <a class="navbar-brand" href="Home.html">CookIt</a>
        <!--<a class="navbar-brand" href="#">Navbar</a> -->
        <ul class="nav navbar-nav">
            
            <li class="nav-item" >
                <a class="nav-link" href="Userprofile.html" id="UserInfo">Information <span class="sr-only"></a>
            </li>

            <li class="nav-item" >
                <a class="nav-link" href="UserFav.html" id="UserFav">Favorites <span class="sr-only"></a>
            </li>
                
            <li class="nav-item" >
                <a class="nav-link" href="UserRecipe.html" id="uploadResU">User Recipes <span class="sr-only"></a>
            </li>
                
            <li class="nav-item" >
                <a class="nav-link" href="UploadForm.html" id="uploadTap">Upload recipe <span class="sr-only"></a>
            </li>
                
            <li class="nav-item" style="float:right" >
                <a class="nav-link" href="RegistrationForm.html" id = "Register"> Register </a>
            </li>
            <li class="nav-item" style="float:right">
                <a class="nav-link" href="#" id = "Loginbtn" > Login </a>
            </li>
            <li class="nav-item" style="float:right">
                <a class="nav-link" href="#" id = "Logoutbtn" style="display : none">Logout </a>
            </li>
            <li class="nav-item" style="float:right">
                <a class="nav-link" href="Userprofile.html" id = "UserName" style="display : none"></a>
            </li>
        
        <!--<form class="form-inline float-xs-right">
            <input class="form-control" type="text" placeholder="Recipe Search">
            <button class="btn btn-outline-success" type="submit">Filter</button>
        </form>-->
        </ul>
    </nav>
    
    <!--<div class="jumbotron jumbotron-fluid" style="background-image:url(/CookItWeb/Cook%20It/images/berries.jpg); background-size: 100%; color:#FFFFFF">
        <div class="container">
            <h1 class="display-3">User recipes</h1>
            <p class="lead">Need a recipe to survive your trip? Well, you came to the right place.</p>
        </div>
    </div>-->
    
    <div class="jumbotron jumbotron-fluid" style="background-image:url(/CookItWeb/Cook%20It/images/berries.jpg); background-size: 100%; color:#FFFFFF">
        
        <div class="container">
            <h1 class="display-3">Recipe Details</h1>
            <p class="lead"></p>
        </div>
    </div>
    <br>
    
<body>
   
     <div id="myModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <span class="close">x</span>
          <h3>Login</h3>
        </div>
        <div class="modal-body">
             <label id=msgError class = "Error" style="display : none" >Wrong username or password</label>
            <p>User name<br>
                <input type="text" id = "UserNameCom"/>
            </p>
            <p>Password<br>
                <input type="password" id = "PasswordCom"/>
            </p>
            <!--<p><input type="checkbox" id="RememberMe" name ="RememberMe"  />Remember me</p>-->
            <span type="buttons"  class = "iden1Small" id = "LoginbtnModal" />Confirm</span>
        </div>
      </div>
    </div>
    

       <div class="container-fluid" id="aboutContainer" style="background-image:url(/CookItWeb/Cook%20It/images/ingredientes.jpg); background-size: 100%;">
        <div class="row" id = "Contenido">
            <br>
            
            
            <div class="col-md-9 bd-content">   
                <h1 class="bd-title" id="content" style="display : none">
                        <a style="font-style: normal; font-variant: normal; font-weight: normal; font-stretch: normal; font-size: 1em; line-height: inherit; font-family: anchorjs-icons; position: absolute; margin-left: -1em; padding-right: 0.5em;"></a><!--Fill with selected option-->
                </h1>
                
                 <form id="display_profile">
                    <br>
                      <div class="form-group">
                        <label><strong>Recipe name: </strong></label>
                        <span id="ResName"></span>
                      </div>
                    
                      <div class="form-group">
                        <label><strong>Time in hours: </strong></label>
                        <span id="ResTime"/></span>
                      </div>
                    
                      <div class="form-group">
                        <label><strong>Ingredients: </strong></label>
                        <br>
                        <pre id="ResIngr"></pre>
                      </div>
                        
                      <div class="form-group">
                        <label><strong>Steps:  </strong></label>
                        <br>
                        <pre id="ResSteps"></pre>
                </form>
           
                
                <input type="button" id="cancelBtnRD" class = "iden2" value="Back"/>
                <input type="button" id="favBtnRD" class = "iden2" value="Favorite"/>
                
            </div>
            
            <div class="col-md-9 bd-content" id="comments"> 
                
            </div>
            
        </div>
    </div>
    
    <hr>
        <div class="container-fluid" id="aboutContainer">
            <p><strong>Comment</strong><br>
            <textarea rows="4" cols="70" id = "ComentarioT">
            </textarea>
            </p>
            <label id="ErrorC" style="display: none;" class = "Error">No puede estar vacio el comentario!!</label>
            <br>
            <input type="button" id="combtnRD" class = "iden2" value="Comment"/>
        </div>
    <hr>
    <div id = "UserComments"></div>
    
<script type="text/javascript">
 $(document).ready(function () { 
        var RecipeId = window.location.search;
        var posIgual = RecipeId.indexOf("=");
        var iDSolo = RecipeId.substr(posIgual + 1);
       
        $("#cancelBtnRD").css({
            "background-color": "#ff3333", 
             "color":"white", 
             "padding":"5px 11px",
             "text-align":"center",
             "display":"inline-block",
             "font-size":"'Hammersmith One', sans-serif",
             "border-radius":"7px",
             "cursor":"pointer"
        });
        
        $("#cancelBtnRD").hover(function(){
            $(this).css("background-color", "#ff6666");
            }, function(){
            $(this).css("background-color", "#ff3333");
        });
     
         $("#combtnRD").css({"background-color": "#4CAF50", 
             "color":"white", 
             "padding":"5px 11px",
             "text-align":"center",
             "display":"inline-block",
             "font-size":"'Hammersmith One', sans-serif",
             "border-radius":"7px",
             "cursor":"pointer"
        });
        
        $("#combtnRD").hover(function(){
            $(this).css("background-color", "#80ff80");
            }, function(){
            $(this).css("background-color", "#4CAF50");
        });  
     
        $("#favBtnRD").css({"background-color": "#800080", 
             "color":"white", 
             "padding":"5px 11px",
             "text-align":"center",
             "display":"inline-block",
             "font-size":"'Hammersmith One', sans-serif",
             "border-radius":"7px",
             "cursor":"pointer"
        });
        
        $("#favBtnRD").hover(function(){
            $(this).css("background-color", "#b300b3");
            }, function(){
            $(this).css("background-color", "#800080");
        });  
     
        $("#ResIngr").css({
             "display":"block",
             "font-size":"'Times New Roman'', Times, serif"
        });
     
         $("#ResSteps").css({
             "display":"block",
             "font-size":"'Times New Roman'', Times, serif"
        });
     
        var jsonRecipeDetail = {
            "action" : "RECIPE-DETAIL",
            "resId" : iDSolo
            };

            $.ajax({
                    url: "data/applicationLayer.php",
                    type: "POST",
                    data : jsonRecipeDetail,
                    dataType: "json",
                    contentType: "application/x-www-form-urlencoded",
                    success: function(jsonResponse){

                        $("#ResName").html(jsonResponse.name);
                        $("#ResTime").html(jsonResponse.timeH);
                        $("#ResIngr").html(jsonResponse.ingredients);
                        $("#ResSteps").html(jsonResponse.steps);



                    },
                    error: function(errorMessage) {
                        alert(errorMessage.responseText);
                    }
            })
            
            //go back to user recipes
            $("#cancelBtnRD").on("click", function(){
                window.location.replace("Home.html");
            });
     
            //Load comments of a recipe
            var jsonLoadCom = {
                "action" : "LOAD-COMMENTS",
                 "resId" : iDSolo
            };

            $.ajax({
                    url: "data/applicationLayer.php",
                    type: "POST",
                    data : jsonLoadCom,
                    dataType: "json",
                    contentType: "application/x-www-form-urlencoded",
                    success: function(jsonResponse){
                       // $("#UserComments").html("");
                        var newHTMLContent = "";
                        var countArr = 0;

                        $.each( jsonResponse, function( i, l ){
                            countArr ++;
                        }); 

                        for (var i = 0; i < countArr-1; i++){
                            newHTMLContent = "";
                            newHTMLContent += jsonResponse[i].firstName + " " + jsonResponse[i].lastName;
                            newHTMLContent += "<br>"
                            newHTMLContent += jsonResponse[i].email;
                            newHTMLContent += "<br>"
                            newHTMLContent += jsonResponse[i].com;
                            $("#UserComments").append(newHTMLContent);
                            $("#UserComments").append("<hr>"); 
                        }

                    },
                    error: function(errorMessage) {
                        // $("#UserComments").append("No comments on this page");
                        alert(errorMessage.responseText);
                    }
                })
     
     //save comment
     $("#combtnRD").click(function(){
          var jsonObject = {
            "action" : "SAVE-COMMENTS",
            "recId" : iDSolo,
            "userCom" : $("#ComentarioT").val()
        };

         var jsonCheckSession = {
            "action" : "CHECK-SESSION"
        };

         $.ajax({
            url: "data/applicationLayer.php",
            type: "POST",
            data : jsonCheckSession,
            dataType: "json",
            contentType: "application/x-www-form-urlencoded",
            success: function(jsonResponse){

            $("#ErrorC").css('display', 'none');

               if($.trim($("#ComentarioT").val()) != ""){
                        $("#UserComments").append("<div>" + jsonResponse.firstName + " " + jsonResponse.lastName + "<br>"); 
                        $("#UserComments").append(jsonResponse.email + "<br>")
                        $("#UserComments").append($("#ComentarioT").val() + "</div>");
                        $("#UserComments").css('display', 'block');
                        $("#UserComments").append("<hr>"); 

                        //Save comment
                        $.ajax({
                            type: "POST",
                            url: "data/applicationLayer.php",
                            data : jsonObject,
                            dataType : "json",
                            contentType : "application/x-www-form-urlencoded",
                            success: function(jsonResponse) {
                                //alert(jsonResponse.message); 
                            },
                            error: function(errorMsg){
                                alert(errorMsg.responseText);
                            }
                        });
                    }
                else{
                    $("#ErrorC").css('display', 'block');
                } 

                $("#ComentarioT").val("");

            },
            error: function(errorMessage) {
                // alert(errorMessage.responseText);
               $("#myModal").css('display', 'block');
            }
        })
    });

     //Save favorite
     $("#favBtnRD").click(function(){
          var jsonObj = {
            "action" : "SAVE-FAV",
            "recId" : iDSolo
        };

         var jsonCheckSession = {
            "action" : "CHECK-SESSION"
        };

         $.ajax({
            url: "data/applicationLayer.php",
            type: "POST",
            data : jsonCheckSession,
            dataType: "json",
            contentType: "application/x-www-form-urlencoded",
            success: function(jsonResponse){
                        
                //Save favorite
                $.ajax({
                    type: "POST",
                    url: "data/applicationLayer.php",
                    data : jsonObj,
                    dataType : "json",
                    contentType : "application/x-www-form-urlencoded",
                    success: function(jsonResponse) {
                        //alert(jsonResponse.message); 
                    },
                    error: function(errorMsg){
                        alert(errorMsg.responseText);
                    }
                });
                    
            },
            error: function(errorMessage) {
                // alert(errorMessage.responseText);
               $("#myModal").css('display', 'block');
            }
        })
    });

     
     
 });
</script>
</body>

    <footer class="footer">
        <div class="container-fluid">

            <span class=""><strong>Need a recipe to survive your trip? Well, you came to the right place.</strong></span>
        </div>
    </footer>

</html>
